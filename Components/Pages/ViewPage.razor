@page "/view/{Id:int}"
@inject JournalService JournalService
@inject NavigationManager Navigation

<h3>View Journal Entry</h3>

@if (entry == null)
{
    <p>Loading entry...</p>
}
else
{
    <div class="card">
        <div class="card-header">
            <h4>@entry.Title</h4>
            <small class="text-muted">
                @entry.EntryDate.ToString("MMMM d, yyyy") | 
                Primary Mood: @entry.PrimaryMood
            </small>
        </div>
        <div class="card-body">
            <div class="content-view" style="min-height: 200px;">
                @((MarkupString)entry.Content)
            </div>
            
            @if (entry.SecondaryMoods.Any())
            {
                <div class="mt-3">
                    <strong>Secondary Moods:</strong>
                    @foreach (var mood in entry.SecondaryMoods)
                    {
                        <span class="badge bg-info me-1">@mood.MoodName</span>
                    }
                </div>
            }
            
            @if (entry.Tags.Any())
            {
                <div class="mt-3">
                    <strong>Tags:</strong>
                    @foreach (var tag in entry.Tags)
                    {
                        <span class="badge bg-secondary me-1">@tag.TagName</span>
                    }
                </div>
            }
        </div>
        <div class="card-footer">
<button class="btn btn-primary" @onclick="() => EditEntry(entry.Id)">
    Edit
            </button>
            <button class="btn btn-secondary" @onclick="GoBack">
                Back
            </button>
        </div>
    </div>
}

@code {
    [Parameter] public int Id { get; set; }
    private JournalEntry? entry;
    
    protected override async Task OnInitializedAsync()
    {
        entry = await JournalService.GetEntryWithDetailsAsync(Id);
    }

    private void EditEntry(int id)
    {
        Navigation.NavigateTo($"/edit/{id}");
    }
    
    private void GoBack()
    {
        Navigation.NavigateTo("/calendar");
    }
}